def writec fn (c)
  #.(LAMBDA (x) (LAMBER::EVAL (PRINC (LAMBER::TOCHAR x)))) c .

alias putChar writec .

;; Leaking abstraction: map is a right fold, so we need to reverse things.
;; And then reverse them back to string when printed.
def writes fn (str)
  reverse : map writec str .

alias putStr writes .

def writesln fn (str)
  writes : rcons '\n' str  .

alias putStrLn writesln .

def writef fn (name str)
  #.(LAMBDA (NAME)
     (LAMBDA (STR)
      (LAMBER::EVAL
       (UIOP:WITH-OUTPUT-FILE (F (LAMBER::TOSTRING NAME)
                              #.(INTERN "IF-EXISTS" "KEYWORD") (INTERN "SUPERSEDE" "KEYWORD"))
        (WRITE-STRING (LAMBER::TOSTRING STR) F))))) name str .

def writeFile writef .

def readc fn (dummy)
  #.(LAMBDA (_) (DECLARE (IGNORE _)) (LAMBER::EVAL (READ-CHAR))) dummy

alias getChar readc .

def readln fn (dummy)
  local char = readc dummy .
  if (char= '\n' char)
   then nil
  else cons char : readln dummy .

alias getLine readln .

def readf fn (name)
  #.(LAMBDA (x) (LAMBER::EVAL (UIOP:READ-FILE-STRING (LAMBER::TOSTRING x)))) name .

alias readFile readf .